{% extends "layout.html" %}

{% block body %}
<div style="margin-top: 15vh;">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- Header -->
                <div class="text-center mb-4">
                    <h2 style="font-weight: 600; color: #1a1a1a; margin-bottom: 10px;">Check Your Admission Status</h2>
                    <p style="color: #666; font-size: 16px;">Search for your name to confirm your admission for the {{ current_academic_year }} academic year</p>
                </div>

                <!-- Instructions -->
                <div class="card shadow-sm mt-4" style="border: none; border-radius: 10px; background-color: #f8f9fa;">
                    <div class="card-body">
                        <h6 style="font-weight: 600; margin-bottom: 15px;">
                            <i class="bi bi-question-circle me-2"></i>How to Use
                        </h6>
                        <ul style="margin-bottom: 0; padding-left: 20px; color: #666;">
                            <li>Select your admission type (Degree or Diploma/ATHE)</li>
                            <li>Enter your full name as it appears on your admission documents</li>
                            <li>The search will show all matching records for the {{ current_academic_year }} academic year</li>
                            <li>If you don't see your name, please verify the spelling and admission type</li>
                        </ul>
                    </div>
                </div>  

                <!-- Admission Type Toggle -->
                <div class="card shadow-sm mb-4" style="border: none; border-radius: 10px;">
                    <div class="card-body">
                        <div class="text-center mb-3">
                            <label class="form-label" style="font-weight: 500; margin-bottom: 15px; display: block;">Select Admission Type:</label>
                            <div class="btn-group" role="group" style="width: 100%; max-width: 400px; margin: 0 auto;">
                                <input type="radio" class="btn-check" name="admissionType" id="degree" value="Degree" 
                                       {% if admission_type == "Degree" %}checked{% endif %}
                                       onchange="updateAdmissionType('Degree')">
                                <label class="btn btn-outline-primary" for="degree" style="flex: 1; padding: 12px 20px; font-weight: 500;">
                                    Degree
                                </label>

                                <input type="radio" class="btn-check" name="admissionType" id="diploma" value="Diploma/ATHE" 
                                       {% if admission_type == "Diploma/ATHE" %}checked{% endif %}
                                       onchange="updateAdmissionType('Diploma/ATHE')">
                                <label class="btn btn-outline-primary" for="diploma" style="flex: 1; padding: 12px 20px; font-weight: 500;">
                                    Diploma/ATHE
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Search Form -->
                <div class="card shadow-sm mb-4" style="border: none; border-radius: 10px;">
                    <div class="card-body">
                        <form method="GET" action="{{ url_for('check_admission') }}" id="searchForm">
                            <input type="hidden" name="type" id="admissionTypeInput" value="{{ admission_type }}">
                            
                            <div class="mb-3">
                                <label for="name" class="form-label" style="font-weight: 500; margin-bottom: 10px;">Enter Your Full Name:</label>
                                <input type="text" 
                                       class="form-control form-control-lg" 
                                       id="name" 
                                       name="name" 
                                       value="{{ search_name }}"
                                       placeholder="e.g., John Kwame Mensah"
                                       style="padding: 15px; font-size: 16px; border-radius: 8px; border: 2px solid #e0e0e0;"
                                       autocomplete="off"
                                       required>
                                <small class="form-text text-muted" style="margin-top: 8px; display: block;">
                                    Search is case-insensitive and supports partial matches
                                </small>
                            </div>
                            
                            <div class="text-center">
                                <button type="submit" class="btn btn-outline-cu btn-lg" 
                                        style="padding: 12px 40px; font-weight: 500; border-radius: 8px; min-width: 150px;">
                                    <i class="bi bi-search me-2"></i>Search
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Results -->
                {% if search_name %}
                    <div class="card shadow-sm" style="border: none; border-radius: 10px;">
                        <div class="card-body">
                            <h5 class="card-title mb-4" style="font-weight: 600;">
                                Search Results for "{{ search_name }}"
                                <span class="badge badge-cu ms-2">{{ admission_type }}</span>
                            </h5>
                            
                            {% if no_results_message %}
                                <div class="alert alert-info" style="border-radius: 8px; border: none; background-color: #e7f3ff; color: #004085;">
                                    <i class="bi bi-info-circle me-2"></i>
                                    <strong>{{ no_results_message }}</strong>
                                    <p class="mb-0 mt-2" style="font-size: 14px;">
                                        Please verify that you've entered your name correctly and selected the correct admission type.
                                    </p>
                                </div>
                            {% elif results %}
                                <div class="table-responsive">
                                    <table class="table table-hover" style="margin-bottom: 0;">
                                        <thead style="background-color: #f8f9fa;">
                                            <tr>
                                                <th style="font-weight: 600; padding: 15px;">Full Name</th>
                                                <th style="font-weight: 600; padding: 15px;">Campus</th>
                                                <th style="font-weight: 600; padding: 15px;">Stream</th>
                                                <th style="font-weight: 600; padding: 15px;">Program Offered</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for record in results %}
                                            <tr style="border-bottom: 1px solid #e9ecef;">
                                                <td style="padding: 15px; font-weight: 500;">{{ record.full_name }}</td>
                                                <td style="padding: 15px;">{{ record.campus }}</td>
                                                <td style="padding: 15px;">{{ record.stream }}</td>
                                                <td style="padding: 15px;">{{ record.program_offered }}</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                <div class="mt-3 text-muted" style="font-size: 14px; text-align: center;">
                                    <i class="bi bi-check-circle-fill text-success me-1"></i>
                                    Found {{ results|length }} matching record{{ 's' if results|length != 1 else '' }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                {% endif %}

            </div>
        </div>
    </div>
</div>

<script>
function updateAdmissionType(type) {
    document.getElementById('admissionTypeInput').value = type;
    // Clear search results when switching types
    const searchForm = document.getElementById('searchForm');
    const nameInput = document.getElementById('name');
    if (nameInput.value) {
        // If there's a search term, submit the form to refresh results
        searchForm.submit();
    }
}

// Auto-focus on name input when page loads
document.addEventListener('DOMContentLoaded', function() {
    const nameInput = document.getElementById('name');
    if (nameInput && !nameInput.value) {
        nameInput.focus();
    }
});
</script>

<style>
/* Central University Color: #992621 */
.btn-check:checked + .btn-outline-primary {
    background-color: #992621;
    border-color: #992621;
    color: white;
}

.btn-outline-primary {
    border-color: #992621;
    color: #992621;
}

.btn-outline-primary:hover {
    background-color: #992621;
    border-color: #992621;
    color: white;
}

.btn-outline-cu {
    border: 2px solid #992621;
    color: #992621;
    background-color: transparent;
}

.btn-outline-cu:hover {
    background-color: #992621;
    border-color: #992621;
    color: white;
}

.badge-cu {
    background-color: #992621;
    color: white;
}

.card {
    transition: transform 0.2s ease-in-out;
}

.card:hover {
    transform: translateY(-2px);
}

.table tbody tr:hover {
    background-color: #f8f9fa;
}
</style>

{% endblock %}
